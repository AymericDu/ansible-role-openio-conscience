---
- hosts: all
  become: true
  vars:
    NS: TRAVIS
  pre_tasks:
    - name: Ensures namespace directory exists
      file:
        dest: "/etc/oio/sds.conf.d"
        state: directory
      tags: install

    - name: Copy using the 'content' for inline data
      copy:
        content: |
          [{{ NS }}]
          # endpoints
          conscience=172.17.0.2:6000
          #zookeeper=172.17.0.2:6005
          proxy=172.17.0.2:6006
          event-agent=beanstalk://172.17.0.2:6014
          ns.meta1_digits=3
          udp_allowed=yes
          ns.storage_policy=THREECOPIES
          ns.chunk_size=10485760
          ns.service_update_policy=meta2=KEEP|3|1|;rdir=KEEP|3|1|;
        dest: "/etc/oio/sds.conf.d/{{ NS }}"
  roles:
    - role: repository
    - role: gridinit
      openio_gridinit_namespace: "{{ NS }}"
    - role: meta0
      openio_meta0_namespace: "{{ NS }}"
    - role: conscienceagent
      openio_conscienceagent_namespace: "{{ NS }}"
    - role: oioproxy
      openio_oioproxy_namespace: "{{ NS }}"
    - role: role_under_test
      openio_conscience_namespace: "{{ NS }}"
      openio_conscience_bind_address: "{{ ansible_default_ipv4.address }}"
      openio_conscience_pools:
        - name: rawx21
          targets:
            - where: rawx-europe
              type: rawx
              count: 2
            - where: rawx-asia
              type: rawx
              count: 1
          min_dist: 2
      openio_conscience_multiple:
        me: "{{ openio_conscience_bind_address }}:18000"
        group:
          - 172.17.0.3:18000
          - 172.17.0.4:18000

...
